{"version":3,"file":"static/js/170.3c326c94.chunk.js","mappings":"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","sources":["pages/PaymentPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { db, auth } from '../firebase';\nimport { collection, getDocs, query, orderBy, addDoc } from 'firebase/firestore';\n\nconst TOSS_CLIENT_KEY = 'test_ck_GjLJoQ1aVZq1pAlkbomJ3w6KYe2R';\n\nfunction PaymentPage() {\n  const [paymentOptions, setPaymentOptions] = useState([]);\n  const [selectedOption, setSelectedOption] = useState(null);\n  const [customAmount, setCustomAmount] = useState('');\n  const [loading, setLoading] = useState(true);\n  const navigate = useNavigate();\n\n  // 결제 옵션 불러오기\n  useEffect(() => {\n    loadPaymentOptions();\n  }, []);\n\n  const loadPaymentOptions = async () => {\n    try {\n      const q = query(collection(db, 'payment_settings'), orderBy('amount', 'asc'));\n      const querySnapshot = await getDocs(q);\n\n      const options = querySnapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data(),\n        value: doc.id\n      }));\n      // 직접입력 옵션 추가\n      options.push({ label: '금액 직접입력', value: 'custom', amount: 0 });\n      setPaymentOptions(options);\n      \n      // 첫 번째 옵션을 기본값으로 설정\n      if (options.length > 0) {\n        setSelectedOption(options[0].value);\n      }\n      setLoading(false);\n    } catch (error) {\n      console.error('Error loading payment options:', error);\n      setLoading(false);\n    }\n  };\n\n  const getAmount = () => {\n    if (selectedOption === 'custom') {\n      return Number(customAmount) || 0;\n    }\n    return paymentOptions.find(opt => opt.value === selectedOption)?.amount || 0;\n  };\n\n  const handlePaymentSuccess = async (paymentResult) => {\n    try {\n      const user = auth.currentUser;\n      if (!user) {\n        navigate('/login');\n        return;\n      }\n\n      // 결제 정보를 Firestore에 저장\n      const paymentRef = await addDoc(collection(db, 'payments'), {\n        label: paymentResult.label,\n        amount: paymentResult.amount,\n        paymentMethod: paymentResult.paymentMethod,\n        timestamp: new Date(),\n        userId: user.uid,\n        userName: user.displayName || '사용자',\n        orderId: paymentResult.orderId,\n        status: 'completed'\n      });\n\n      console.log('Payment saved===>', paymentRef.id, paymentResult.paymentMethod, paymentResult.label, paymentResult.amount);\n\n      // PaymentSuccess 페이지로 이동하면서 필요한 정보 전달\n      navigate(`/payment/success?orderId=${paymentResult.orderId}&paymentKey=${paymentResult.paymentKey}&amount=${paymentResult.amount}&paymentSettingId=${selectedOption}`, { \n        replace: true\n      });\n    } catch (error) {\n      console.error('Error saving payment:', error);\n      alert('결제 정보 저장 중 오류가 발생했습니다.');\n    }\n  };\n\n  function requestTossPayment(amount) {\n    const orderId = 'order_' + Date.now();\n    const tossPayments = window.TossPayments(TOSS_CLIENT_KEY);\n    \n    const selectedOptionLabel = paymentOptions.find(opt => opt.value === selectedOption)?.label || '직접입력';\n    \n    tossPayments.requestPayment('카드', {\n      amount,\n      orderId,\n      orderName: selectedOptionLabel,\n      customerName: '테스트회원',\n      successUrl: window.location.origin + '/payment/success',\n      failUrl: window.location.origin + '/payment-fail',\n    })\n    .then(function (result) {\n      console.log('Payment result:', result);\n      // 결제 성공 시 처리\n      handlePaymentSuccess({\n        ...result,\n        orderId: orderId,\n        paymentKey: result.paymentKey\n      });\n    })\n    .catch(function (error) {\n      if (error.code === 'USER_CANCEL') {\n        alert('결제가 취소되었습니다.');\n      } else {\n        alert('결제에 실패했습니다.\\n' + error.message);\n      }\n    });\n  }\n\n  const handlePayment = () => {\n    const amount = getAmount();\n    if (!window.TossPayments) {\n      const script = document.createElement('script');\n      script.src = 'https://js.tosspayments.com/v1/payment';\n      script.async = true;\n      document.body.appendChild(script);\n      script.onload = () => {\n        requestTossPayment(amount);\n      };\n      script.onerror = () => {\n        alert('결제 모듈을 불러오지 못했습니다. 잠시 후 다시 시도해주세요.');\n      };\n      return;\n    }\n    requestTossPayment(amount);\n  };\n\n  if (loading) {\n    return <div>로딩중...</div>;\n  }\n\n  return (\n    <div className=\"payment-page-container\" style={{ maxWidth: 400, margin: '40px auto', padding: 20, background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px rgba(0,0,0,0.08)' }}>\n      <h2>결제하기(시험중으로서 지금은 결제가 이루어지지 않습니다)</h2>\n      <div style={{ marginBottom: 24 }}>\n        {paymentOptions.map(opt => (\n          <div key={opt.value} style={{ marginBottom: 12 }}>\n            <label>\n              <input\n                type=\"radio\"\n                name=\"paymentOption\"\n                value={opt.value}\n                checked={selectedOption === opt.value}\n                onChange={() => setSelectedOption(opt.value)}\n              />\n              {opt.label}\n              {opt.value !== 'custom' && (\n                <span style={{ marginLeft: 8, color: '#888' }}>({opt.amount.toLocaleString()}원)</span>\n              )}\n            </label>\n          </div>\n        ))}\n        {selectedOption === 'custom' && (\n          <div style={{ marginTop: 8 }}>\n            <input\n              type=\"number\"\n              min=\"9000\"\n              step=\"1000\"\n              placeholder=\"금액을 입력하세요 (원)\"\n              value={customAmount}\n              onChange={e => setCustomAmount(e.target.value)}\n              style={{ width: '100%', padding: 8, borderRadius: 4, border: '1px solid #ccc' }}\n            />\n          </div>\n        )}\n      </div>\n      <button\n        onClick={handlePayment}\n        style={{ width: '100%', padding: 12, background: '#007bff', color: '#fff', border: 'none', borderRadius: 4, fontSize: 16, cursor: 'pointer' }}\n        disabled={getAmount() < 9000}\n      >\n        결제하기\n      </button>\n    </div>\n  );\n}\n\nexport default PaymentPage; "],"names":["paymentOptions","setPaymentOptions","useState","selectedOption","setSelectedOption","customAmount","setCustomAmount","loading","setLoading","navigate","useNavigate","useEffect","loadPaymentOptions","async","q","query","collection","db","orderBy","options","getDocs","docs","map","doc","id","data","value","push","label","amount","length","error","console","getAmount","_paymentOptions$find","Number","find","opt","requestTossPayment","_paymentOptions$find2","orderId","Date","now","tossPayments","window","TossPayments","selectedOptionLabel","requestPayment","orderName","customerName","successUrl","location","origin","failUrl","then","result","log","user","auth","currentUser","paymentRef","addDoc","paymentResult","paymentMethod","timestamp","userId","uid","userName","displayName","status","paymentKey","replace","alert","handlePaymentSuccess","catch","code","message","_jsx","children","_jsxs","className","style","maxWidth","margin","padding","background","borderRadius","boxShadow","marginBottom","type","name","checked","onChange","marginLeft","color","toLocaleString","marginTop","min","step","placeholder","e","target","width","border","onClick","handlePayment","script","document","createElement","src","body","appendChild","onload","onerror","fontSize","cursor","disabled"],"sourceRoot":""}